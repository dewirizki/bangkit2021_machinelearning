# Prediction

## Flow of request
Per [the Google Cloud article on online predictions](https://cloud.google.com/ai-platform/prediction/docs/online-predict#java) and [the Google Cloud docs on predict](https://cloud.google.com/ai-platform/prediction/docs/reference/rest/v1/projects/predict):

Send a request. The first article gives explanation in three ways: Python, gcloud shell command and Java. If the mobile developers are using Kotlin, then one may wish to adjust based on the Java code.

Send the input value containing the input required (check below), and the model will respond with a JSON value of the response.

For the record, the window size for the prediction is 180 floats, meaning one must push 180 float values (normalised by dividing it with 35000) in order to get a prediction of one day. One may wish to use the [sliding window technique](https://en.wikipedia.org/wiki/Sliding_window_protocol) in order to get multiple predictions in one request. Meaning: one must send a request consisting of 180 instances.

For the fertiliser, one need to upload in sequential these files, divided by 100: temperature, humidity, model and wanted output.

## Data technicalities
The data used for training (and testing) is in "/dataset/time-series/Harga Pangan - compiled.xlsx". One may wish to save the file in order to get accurate predictions. Make sure to fill the missing values, though.

### Fertiliser
For the fertiliser, here is the enumeration for model:
- 0: Corn
- 1: Grapes
- 2: Apple
- 3: Orange
- 4: Soybean (upcoming!)

Here is the value for the wanted output:
- 0: Nitrogen (N)
- 1: Phosphorus (P)
- 2: Potassium (K)

## Detailed explanation
### Price Forecast
- Project ID: Yubisayu
- Model name: price_forecast
- Version: price_forecast_180

#### Sample GCloud request
    gcloud ai-platform predict --model="price_forecast" --version="price_forecast_180" --json-request="D:\Projects\capstone-project\sample-forecast-req.json" --region=asia-southeast1

##### Input:
[0.73857143, 0.74428571, 0.74607143, 0.75857143, 0.74285714, 0.71142857, 0.75857143, 0.71142857, 0.74428571, 0.73952381, 0.76285714, 0.73452381, 0.71142857, 0.72428571, 0.76, 0.73714286, 0.73607143, 0.72714286, 0.72, 0.72142857, 0.71761905, 0.71142857, 0.71349206, 0.71265873, 0.71142857, 0.71428571, 0.72, 0.72, 0.72, 0.71333333, 0.70440476, 0.7, 0.68428571, 0.7, 0.67571429, 0.69285714, 0.7, 0.70809524, 0.73142857, 0.73309524, 0.73142857, 0.76142857, 0.75714286, 0.73714286, 0.72178571, 0.69285714, 0.7, 0.72, 0.7, 0.71, 0.70285714, 0.71428571, 0.69857143, 0.74571429, 0.71142857, 0.71, 0.71071429, 0.69880952, 0.69880952, 0.67571429, 0.71, 0.71, 0.69714286, 0.71, 0.70285714, 0.70178571, 0.70142857, 0.69285714, 0.70571429, 0.69285714, 0.68428571, 0.6952381, 0.69916667, 0.70857143, 0.70857143, 0.69857143, 0.69857143, 0.71142857, 0.70333333, 0.70333333, 0.7, 0.69857143, 0.69857143, 0.72571429, 0.72857143, 0.73380952, 0.73130952, 0.74714286, 0.71571429, 0.71571429, 0.71571429, 0.71857143, 0.71666667, 0.71952381, 0.71571429, 0.72714286, 0.73, 0.72571429, 0.73428571, 0.72666667, 0.72595238, 0.72, 0.72285714, 0.71571429, 0.70571429, 0.73, 0.71714286, 0.7225, 0.71571429, 0.72714286, 0.72714286, 0.71571429, 0.70714286, 0.71619048, 0.71619048, 0.72571429, 0.71571429, 0.72142857, 0.72, 0.72071429, 0.71214286, 0.70785714, 0.69571429, 0.70285714, 0.70392857, 0.70285714, 0.71428571, 0.70761905, 0.70833333, 0.70571429, 0.70571429, 0.71142857, 0.71571429, 0.71, 0.71952381, 0.72666667, 0.73285714, 0.74428571, 0.74428571, 0.74857143, 0.72857143, 0.71428571, 0.70285714, 0.66571429, 0.70642857, 0.72857143, 0.72857143, 0.72, 0.72571429, 0.72428571, 0.72857143, 0.72285714, 0.72285714, 0.72428571, 0.73, 0.72238095, 0.72559524, 0.71285714, 0.73714286, 0.70428571, 0.70428571, 0.71285714, 0.71571429, 0.73607143, 0.73, 0.78571429, 0.74857143, 0.74428571, 0.74714286, 0.7452381, 0.74630952, 0.74428571, 0.74857143, 0.74428571, 0.72857143, 0.73285714, 0.73666667, 0.74309524, 0.74857143, 0.75428571]

##### Output:
    PS C:\Users\vin> gcloud ai-platform predict --model="price_forecast" --version="price_forecast_180" --json-request="D:\Projects\capstone-project\sample-forecast-req.json" --region=asia-southeast1
    Using endpoint [https://asia-southeast1-ml.googleapis.com/]
    [[0.718978405]]
> The returned array indicates the predicted value from the model. Multiply it by 35000 in the app, since the model has been normalised and needs readjustment of values.

#### Sample JSON
```
{
	"instances": [
		[0.73857143, 0.74428571, 0.74607143, 0.75857143, 0.74285714, 0.71142857, 0.75857143, 0.71142857, 0.74428571, 0.73952381, 0.76285714, 0.73452381, 0.71142857, 0.72428571, 0.76, 0.73714286, 0.73607143, 0.72714286, 0.72, 0.72142857, 0.71761905, 0.71142857, 0.71349206, 0.71265873, 0.71142857, 0.71428571, 0.72, 0.72, 0.72, 0.71333333, 0.70440476, 0.7, 0.68428571, 0.7, 0.67571429, 0.69285714, 0.7, 0.70809524, 0.73142857, 0.73309524, 0.73142857, 0.76142857, 0.75714286, 0.73714286, 0.72178571, 0.69285714, 0.7, 0.72, 0.7, 0.71, 0.70285714, 0.71428571, 0.69857143, 0.74571429, 0.71142857, 0.71, 0.71071429, 0.69880952, 0.69880952, 0.67571429, 0.71, 0.71, 0.69714286, 0.71, 0.70285714, 0.70178571, 0.70142857, 0.69285714, 0.70571429, 0.69285714, 0.68428571, 0.6952381, 0.69916667, 0.70857143, 0.70857143, 0.69857143, 0.69857143, 0.71142857, 0.70333333, 0.70333333, 0.7, 0.69857143, 0.69857143, 0.72571429, 0.72857143, 0.73380952, 0.73130952, 0.74714286, 0.71571429, 0.71571429, 0.71571429, 0.71857143, 0.71666667, 0.71952381, 0.71571429, 0.72714286, 0.73, 0.72571429, 0.73428571, 0.72666667, 0.72595238, 0.72, 0.72285714, 0.71571429, 0.70571429, 0.73, 0.71714286, 0.7225, 0.71571429, 0.72714286, 0.72714286, 0.71571429, 0.70714286, 0.71619048, 0.71619048, 0.72571429, 0.71571429, 0.72142857, 0.72, 0.72071429, 0.71214286, 0.70785714, 0.69571429, 0.70285714, 0.70392857, 0.70285714, 0.71428571, 0.70761905, 0.70833333, 0.70571429, 0.70571429, 0.71142857, 0.71571429, 0.71, 0.71952381, 0.72666667, 0.73285714, 0.74428571, 0.74428571, 0.74857143, 0.72857143, 0.71428571, 0.70285714, 0.66571429, 0.70642857, 0.72857143, 0.72857143, 0.72, 0.72571429, 0.72428571, 0.72857143, 0.72285714, 0.72285714, 0.72428571, 0.73, 0.72238095, 0.72559524, 0.71285714, 0.73714286, 0.70428571, 0.70428571, 0.71285714, 0.71571429, 0.73607143, 0.73, 0.78571429, 0.74857143, 0.74428571, 0.74714286, 0.7452381, 0.74630952, 0.74428571, 0.74857143, 0.74428571, 0.72857143, 0.73285714, 0.73666667, 0.74309524, 0.74857143, 0.75428571],
		[0.70571429, 0.70714286, 0.70761905, 0.70869048, 0.71, 0.71, 0.73571429, 0.70857143, 0.69714286, 0.70666667, 0.70380952, 0.71428571, 0.69714286, 0.7, 0.71714286, 0.72142857, 0.72, 0.72107143, 0.72142857, 0.72142857, 0.72428571, 0.74142857, 0.72714286, 0.7347619, 0.73404762, 0.73571429, 0.73857143, 0.72857143, 0.73428571, 0.74857143, 0.73857143, 0.74642857, 0.73285714, 0.76571429, 0.74571429, 0.83857143, 0.73285714, 0.80952381, 0.79738095, 0.85714286, 0.79, 0.88238095, 0.89079365, 1.0, 0.87455026, 0.83578042, 0.73285714, 0.73571429, 0.73571429, 0.73857143, 0.74857143, 0.74380952, 0.7452381, 0.74428571, 0.74428571, 0.74428571, 0.74428571, 0.74428571, 0.74428571, 0.74428571, 0.74428571, 0.74428571, 0.73571429, 0.74428571, 0.73571429, 0.73857143, 0.73857143, 0.73571429, 0.74428571, 0.74428571, 0.73571429, 0.74428571, 0.73857143, 0.73785714, 0.73571429, 0.73285714, 0.77142857, 0.74714286, 0.75714286, 0.75047619, 0.74833333, 0.74714286, 0.73857143, 0.74714286, 0.74714286, 0.75285714, 0.74428571, 0.74428571, 0.73285714, 0.74714286, 0.74714286, 0.73857143, 0.74714286, 0.74142857, 0.74357143, 0.73857143, 0.74714286, 0.74714286, 0.72857143, 0.74285714, 0.73666667, 0.73845238, 0.73857143, 0.73571429, 0.73857143, 0.73857143, 0.73857143, 0.73428571, 0.73428571, 0.72571429, 0.73857143, 0.73857143, 0.74714286, 0.74285714, 0.74, 0.73821429, 0.73, 0.74, 0.74714286, 0.74714286, 0.73714286, 0.74714286, 0.74964286, 0.75714286, 0.75714286, 0.75714286, 0.77857143, 0.77857143, 0.77333333, 0.77190476, 0.76285714, 0.77285714, 0.76285714, 0.76285714, 0.76285714, 0.76238095, 0.75702381, 0.76142857, 0.74142857, 0.75571429, 0.75571429, 0.76142857, 0.76095238, 0.76345238, 0.76571429, 0.76571429, 0.76571429, 0.76571429, 0.76571429, 0.76666667, 0.76416667, 0.76857143, 0.75571429, 0.78142857, 0.78142857, 0.78142857, 0.77285714, 0.77535714, 0.75571429, 0.79142857, 0.79142857, 0.79428571, 0.79142857, 0.79333333, 0.79333333, 0.79428571, 0.79428571, 0.79428571, 0.79142857, 0.79142857, 0.80714286, 0.80642857, 0.83857143, 0.78857143, 0.78, 0.78, 0.78, 0.77571429, 0.76928571, 0.76714286]
	]
}
```

### Fertiliser
- Project ID: Yubisayu
- Model name: fertilizer_recommender
- Version name: fertilizer_recommender_unified

#### Sample GCloud request:
    gcloud ai-platform predict --model="fertilizer_recommender" --version="fertilizer_recommender_unified" --json-request="D:\Projects\capstone-project\test\fertiliser\sample-forecast-req.json" --region=asia-southeast1

##### Input
    [0.390656, 0.820381, 1, 2]
##### Output
    PS D:\Projects\capstone-project> gcloud ai-platform predict --model="fertilizer_recommender" --version="fertilizer_recommender_unified" --json-request="D:\Projects\capstone-project\test\fertiliser\sample-forecast-req.json" --region=asia-southeast1
    Using endpoint [https://asia-southeast1-ml.googleapis.com/]
    [[0.141042724], [1.9831835]]

#### Sample JSON
```
{
	"instances": [
		[0.100108, 0.902240, 3, 1],
		[0.390656, 0.820381, 1, 2]
	]
}
```
